---
date: 2014-07-12 00:14:31+00:00
layout: post
title: 分析 Substrate 的 THUMB 函数 Hook 实现细节
categories: 文档
tags: iOS 逆向工程
---

### 2.5 控制流

#### 基础
---
`for index in 1..5 {...}`，`index` 无需显式声明，是一个自动赋值的**常量**，只存在于循环生命周期里。

如果只需要确保执行的循环次数而不关心具体值，使用 `_` 代替变量名：`for _ in 1..5 {...}`。

> while condition {
      statements
  }

> do {
      statements
  } while condition
  
`switch` 语句必须是完备的，如果 `case` 无法涵盖所有可能值，就必须包含 `default` 分支。

每个分支都**必须**包含至少一条语句，case 可以匹配区间：

```c
    switch count {
    case 0:  //报错，没有对应语句，swift 并不会同时匹配 0 和 1..2
    case 1..2:
        ...
    }
```

元组匹配：

```c
    let somePoint = (1, 1)
    switch somePoint {
    case (0, 0): ...
    case (_, 0): ... // `_` 匹配所有可能值
    case (0, _): ...
    case (-2...2, -2...2): ...  // 点（1，1）匹配这里
    default: ...
    }
```

> Swift 允许多个 case 匹配同一个值，比如（0，0）可以匹配上例四个 case，但只会执行第一个匹配到的。

值绑定：

    let anotherPoint = (2, 0)
    switch anotherPoint {
    case (let x, 0):
        println("\(x)") // 可以使用 x
    case (0, let y):
        println("\(y)")
    case let (x, y):  // 此处可以匹配所有剩余值的元组，所以不需要 default 分支
        println("(\(x), \(y))")
    }
    
`where` 语句：

    let yetAnotherPoint = (1, -1)
    switch yetAnotherPoint {
    case let (x, y) where x == y:
        println("(\(x), \(y)) is on the line x == y")
    case let (x, y) where x == -y:
        println("(\(x), \(y)) is on the line x == -y")
    case let (x, y):
        println("(\(x), \(y)) is just some arbitrary point")
    }

#### 控制转移
---
- `continue`：立即停止本次循环，开始下次循环
- `break`：立刻结束整个控制流
- `fallthrough`：swift 中 switch执行完一个匹配的 case 后就会结束整个 switch 代码块，不会落入下一个分支，所以不用在每个 case 中写 break。如果需要这种行为，使用 `fallthrough` 关键字：

        let count = 5
        switch count {
        case: 1, 3, 5:
            ...          // 匹配执行
            fallthrough
        default:
            ...          // 执行
        }
        
> `fallthrough` 关键字不会检查它下一个将会落入执行的 case 中的匹配条件。

标签：显式的指明想要作用于哪个代码块。

    loop: while i < 5 {
        for (var i=0; i<10; ++i) {
            if i == 5 {
                break loop  // 如果没有标签，break 中断的是 for 循环
            }
        }
    }